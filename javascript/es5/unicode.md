# Unicode字符集

将全世界所有的字符包含在一个集合里

* 码点：`U+十六进制数`，表示字符的序号
* 字符：码点对应的符号

## 编号规则

* 从`0`开始编号，`U+0000`=null
* 分区定义，每`65536(2^16)`个字符为一平面
  * `1`个基本平面(`BMP`): `U+0000 ~ U+FFFF`
  * `16`个辅助平面(`SMP`): `U+010000 ~ U+10FFFF`

## 编码规则

### UTF-8

使用`1-4`个字节表示一个符号，根据不同的符号而变化字节长度

* 对于单字节的符号，字节的第一位设为`0`，后面`7`位为这个符号的`unicode`码，与`ASCII`码相同
* 对于`n`字节的符号（`n>1`），第一个字节的前`n`位都设为`1`，第`n+1`位设为`0`，后面字节的前两位一律设为`10`。剩下的没有提及的二进制位，全部为这个符号的`unicode`码

```
Unicode符号范围      | UTF-8编码方式
(十六进制)           | (二进制)
--------------------+---------------------------------------------
0000 0000-0000 007F | 0xxxxxxx
0000 0080-0000 07FF | 110xxxxx 10xxxxxx
0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
```

### UTF-16

使用`2`个字节或`4`字节表示一个符号

* 基本平面(`U+0000`到`U+FFFF`之间)的字符用`2`个字节表示
  * `U+D800`到`U+DFFF`之间的码点被用来映射辅助平面，映射不了时当作无法识别
* 辅助平面(`U+10000到U+10FFFF`之间)的字符用`4`个字节表示
  * 高位在`U+D800`到`U+DBFF`之间
  * 低位在`U+DC00`到`U+DFFF`之间

```
// 将大于U+FFFF的字符，从Unicode转为UTF-16
H = Math.floor((C - 0x10000) / 0x400) + 0xD800
L = (C - 0x10000) % 0x400 + 0xDC00

// 将大于U+FFFF的字符，从UTF-16转为Unicode
C = (H - 0xD800) * 0x400 + L - 0xDC00 + 0x10000
```

### UTF-32

使用`4`个字节表示一个符号，完全对应`Unicode`编码

* 转换规则简单直观
* 浪费空间

### UCS-2

`UTF-16`的一个子集，用`2`个字节表示基本平面的字符